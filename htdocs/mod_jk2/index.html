<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0px; padding: 0px }
      #tokyo, #linz { height: 100%; width: 100%; opacity: 0.5; position:absolute; top:0; left:0}
      #streetview { height: 80%; width: 80%; position: absolute; top:10%; left: 10%}
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.js"></script>
    <script src="http://realtimeweblog.in:3000/socket.io/socket.io.js" type="text/javascript" charset="UTF-8"></script>
    <script src="http://maps.google.com/maps/api/js?v=3&sensor=false"
        type="text/javascript" charset="UTF-8"></script>

    <script type="text/javascript">
    //<![CDATA[

    var linz;
    var tokyo;
    var panorama;
    var $list;
   
    function init() {
      $list = $('<ul><li></li></ul>').appendTo('body');

      // liniz
      var latlng = new google.maps.LatLng(48.309292, 14.284233);
      var opts = {
        zoom: 16,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: latlng
      };
      linz = new google.maps.Map(document.getElementById("linz"), opts);
      
      // tokyo
      var latlng = new google.maps.LatLng(35.663411, 139.70502);
      var opts = {
        zoom: 16,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: latlng
      };
      tokyo = new google.maps.Map(document.getElementById("tokyo"), opts);

      var panoramaOptions = {
        position: latlng,
        pov: {
          heading: 300,
          pitch: 0,
          zoom: 1
        }
      };
      panorama = new google.maps.StreetViewPanorama(document.getElementById("streetview"), panoramaOptions);
      tokyo.setStreetView(panorama);
      //heading();
      //move();

      socket = io.connect('http://realtimeweblog.in:3000');
      socket.on('heading', function(data) {
        if(data != undefined)
        {
          log('heading', data);
          heading(data);
        }
      });
      socket.on('location', function(data) {
        if(data != undefined)
        {
          log('location', data);
          data.latitude += -12.645881;
          data.longitude += 125.420787;
          move(data);
        }
      });
    };

    var count = 0;
    var timerId;
    function heading(data) {
        console.log(JSON.stringify(data));
        var heading = data.trueHeading;
        console.log(heading);
        panorama.setPov(
          {
            heading: heading,
            pitch: 1,
            zoom: 1
          }
        );
    }

    function move(data) {
        var latitude = data.latitude;
        var longitude = data.longitude;
        var latlng = new google.maps.LatLng(latitude, longitude);
        panorama.setPosition(
          latlng
        );
    }

    function log(type, data) {
        $list.prepend($('<li>' + type  + ': ' + JSON.stringify(data) + '</li>'));			
        if ($list.find('li').length > 10) {
            $list.find('li').last().remove();
        }
        if (console) {
//            console.log([type, JSON.stringify(data)]);
        }
    }
		

    //]]>
    </script>
  </head>
  <body onload="init()">
    <div id="tokyo"></div>
    <div id="linz"></div>
    <div id="streetview"></div>
  </body>
</html>
