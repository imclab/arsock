<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0px; padding: 0px }
      #linz { height: 33%; width: 100%; opacity: 0.8; position:absolute; top:0; left:0}
      #tokyo { height: 33%; width: 100%; opacity: 0.8; position:absolute; top:66%; left:0}
      #streetview { height: 33%; width: 100%; opacity: 0.8;  position: absolute; top:33%; left: 0%}
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.js"></script>
    <script src="http://realtimeweblog.in:3000/socket.io/socket.io.js" type="text/javascript" charset="UTF-8"></script>
    <script src="http://maps.google.com/maps/api/js?v=3&sensor=false"
        type="text/javascript" charset="UTF-8"></script>

    <script type="text/javascript">
    //<![CDATA[

    var linz;
    var tokyo;
    var panorama;
    var $list;
    var marker;
   
    function init() {
      $list = $('<ul><li></li></ul>').appendTo('body');

      // liniz
      var latlng = new google.maps.LatLng(48.309292, 14.284233);
      var opts = {
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: latlng
      };
      linz = new google.maps.Map(document.getElementById("linz"), opts);
      
      // tokyo
      var latlng = new google.maps.LatLng(35.663411, 139.70502);
      var opts = {
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        center: latlng
      };
      tokyo = new google.maps.Map(document.getElementById("tokyo"), opts);

      var panoramaOptions = {
        position: latlng,
        pov: {
          heading: 300,
          pitch: 0,
          zoom: 1
        }
      };
      panorama = new google.maps.StreetViewPanorama(document.getElementById("streetview"), panoramaOptions);
      tokyo.setStreetView(panorama);
      //heading();
      //move();

      // marker
      var img = 'http://www.gravatar.com/avatar/0d22cf6120bdd1f4f70e9845a2c14793?d=https://gp1.wac.edgecastcdn.net/801245/assets1.socialcast.com/images/default_avatar_square45.png&s=45';
      marker = new google.maps.Marker({
          position: latlng, 
          map: linz,
          icon:img 
        });   

      // polyline
      polyline = new google.maps.Polyline({
        path: [],
        strokeColor: "#FF0000",
        strokeOpacity: 1.0,
        strokeWeight: 2
      });

      polyline.setMap(linz);

      socket = io.connect('http://realtimeweblog.in:3000');
      socket.on('heading', function(data) {
        if(data != undefined)
        {
          log('heading', data);
          heading(data);
        }
      });
      socket.on('location', function(data) {
        if(data != undefined)
        {
        var latitude = data.latitude;
        var longitude = data.longitude;
        var latlng = new google.maps.LatLng(latitude, longitude);
        marker.setPosition(latlng);
          var path = polyline.getPath();
          path.push(latlng);
          log('location', data);
          data.latitude += -12.645881;
          data.longitude += 125.420787;
          move(data);
          
        }
      });
    };

    var count = 0;
    var timerId;
    function heading(data) {
        console.log(JSON.stringify(data));
        var heading = data.trueHeading;
        console.log(heading);
        panorama.setPov(
          {
            heading: heading,
            pitch: 1,
            zoom: 1
          }
        );
    }

    function move(data) {
        var latitude = data.latitude;
        var longitude = data.longitude;
        var latlng = new google.maps.LatLng(latitude, longitude);
        panorama.setPosition(
          latlng
        );

//        var marker = new google.maps.Marker({
 //         position: latlng, 
  //        map: tokyo, 
   //     });   

    }

    function log(type, data) {
        $list.prepend($('<li>' + type  + ': ' + JSON.stringify(data) + '</li>'));			
        if ($list.find('li').length > 10) {
            $list.find('li').last().remove();
        }
        if (console) {
//            console.log([type, JSON.stringify(data)]);
        }
    }
		

    //]]>
    </script>
  </head>
  <body onload="init()">
    <div id="tokyo"></div>
    <div id="linz"></div>
    <div id="streetview"></div>
  </body>
</html>
